## Отличие сценариев V5 от V4

Сценарии V5 выполняются в отдельном worker-e. При ошибке выполнения или зацикливании сценарий блокируется и больше запускаться не будет.   
Для восстановления работы нужно исправить ошибку и вручную разблокировать сценарий


### Триггеры
1. Триггером может быть как событие изменения любого свойства устройства, так и конкретного свойства:
   startOnChange([motion.state, lamp.auto, darkSensor])

2. Триггером может быть событие изменения глобальной переменной:
   startOnChange([motion, dimmer, globals.guard])

3. Триггеры, по которым запущен сценарий, доступны внутри скрипта как массив this.triggers:
   (может быть одно или несколько свойств)
   this.log('Triggers='+this.triggers.join(',')) // DIMMER1.state,DIMMER1.value

### Условие запуска сценария 
Условие запуска, которое можно было передать в startOnChange вторым параметром, больше не используется
?? Вместо этого внутри скрипта можно создать функцию check() ??

### Доступ к свойствам и командам устройств  

Синтаксис работы с устройством одинаков для использования в обработчиках и сценариях
Доступ к любому свойству выполняется через точку

1.  getParam больше не используется
  Любое свойство устройства доступно для чтения и использования в условных выражениях через точку:

   >if (motion.state && lamp.auto && !motion.error) lamp.on();

2. Свойства-команды вызываются как метод устройства (как on/off в v4)
   
  >blind1.up();
  >lamp.toggle();

3. Для присваивания значения свойствам используются функции устройства setValue и assign
   
   Отличие между этими функциями в отработке операции записи свойства:  

   **setValue**   Запись выполняется через привязанный канал, значение свойству будет присвоено только в результате чтения из канала (механизм зависит от плагина и настроек канала)

   >pump.setValue('state',1); // 

   **assign**   Запись в канал НЕ выполняется, значение напрямую присваивается свойству.
   Таким образом можно присвоить значение датчику, счетчику и т д 
   Но важно понимать, что  если  есть привязка, при поступлении данных с канала значение будет заменено 
   >sensor.assign('value',42); // 

   Если нет привязки к каналу, результат будет одинаков

4. Устройства имеют общие функции  и команды:
   
   device.log(txt); // Запись в журнал устройства

5. РАСШИРЕННЫХ СВОЙСТВ, определяемых сценариями, больше нет
   Список свойств и команд устройства зависит от типа
   При необходимости добавить свойство нужно расширить существующий тип или создать новый


### Таймеры

### Мультисценарии

1. Определение мультисценария

Концепция мультисценария, при которой в скрипте используются не реальные устройства системы, а устройства-шаблоны, осталась прежней. Это удобно, так как:
 - Созданный сценарий можно использовать для многих наборов устройств, при этом код скрипта загружается 1 раз и не нуждается в изменении при добавлении новых наборов 
 - Такими скриптами легко обмениваться, они не требуют доработок, бери и  пользуйся

Является ли сценарий мультисценарием теперь определяется галочкой Мультисценарий 

2. Описание устройств, участвующих в сценарии

Изменился синтаксис описания устройств.   
Функция Device теперь имеет только 1 аргумент:

  const motion = Device('DD101'); // Для обычного сценария нужно, чтобы устройство DD101 существовало, иначе сценарий будет заблокирован из-за ошибки

  const motion = Device('Датчик движения'); // Для мультисценария
  const motion = Device('DD101'); // Для мультисценария также будет работать, просто в шапке столбца для подбора устройств будет написано не Датчик движения, а DD101

Таким образом, переход от разработанного и отлаженного простого сценария к мультисценарию является тривиальным

3. Подбор устройств

В V4 при подборе устройств для мультисценария учитывался класс устройства (Дискретный/Аналоговый Сенсор/Актуатор/Счетчик):  Device('ActorD', 'Светильник')

Поскольку в V5 классы не используются, а типы могут меняться совершенно призвольно, для подбора устройств применяется т н "утиная типизация", а именно наличие свойств/команд, которые используются в сценарии.
Т о, если в сценарии используется только  свойство state, список будет влючать вероятно все устройства системы







   






   
